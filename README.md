# mailto.py
Script for handling Email Groups via JSON objects while utilising custom user email templates. 

An internal request to handle email groups that currently isn't supported by OLGR's current mail system.  
Glorified mailto: URI link handler  
This script has four utility scripts: 
* MailtoManage.py - Main utility to manage email groups. 
* TemplateEditor.py - Utility to generate Email Templates for used with the mailto.py script.  
* mailtodata.py - Utility to convert previous `emaildata.json` to `emaildata_v2.json` and `emaildata_lookup.json` files

mailto.py script uses templates generated by users to easily select email templates with custom email groups to clients. The mail group database is stored as a JSON file. 

As of v0.6 the script has been updated to support unique email addresses. Email Groups will therefore be more accurate as only one email address exists for that user. This is accomplished via truncating the email address to just: `blah@domain.com` and generating a hash, and using a flat table with the hash as an index to the actual email address (refer `emaildata_lookup.json` for details) 

Hashing of Email Groups for added security has also been added to prevent unauthorised changes directly to the .json file. 

## How to Use

You just double-click the mailto.py file and provided your Operating System is configured to launch python scripts a GUI will be presented to you. 

Follow the "Quick HOWTO" instructions described above the screen.  

The "tabs": "EGM", "Systems" and "Other" represents the workflow of email templates Note: The "Other" tab is for email templates, which doesn't fit with either EGM/Systems. 
i.e. the addressee isn't exactly a client. 

## Creating new "Templates"

Best way of creating a template is to copy a new one, and replace the contents with 
the appropriate changes using the TemplateEditor.py script.  

## Restrictions with Creating New Templates
    1. The first word of the file name, will indicate where the template can be used. 
        e.g."EGM - Game Approval Letter.json" - will only be available in the "EGM"-tab. 
        Likewise, "Other - Technical Requirements" - will only be available in the "Other"-tab. 

    2.  Email addresses to be used in the "to:", "cc:" and "bcc:" sections should be 
        email groups that are available in the "emaildata_v2.json" file. You can't put "bob@hotmail.com" 
        in the actual template. The Email: bob@hotmail.com can be added to any group listed
        in the "emaildata.json" file, and you would add that group to the template instead. 
       
    3. Templates must be saved in the "templates" subdirectory. 
    
    4. Must utilise the following JSON structure: 

        {
          "$schema": "http://json-schema.org/draft-04/schema#",
          "type": "object",
          "properties": {
            "Email Template": {
              "type": "object",
              "properties": {
                "title": {
                  "type": "string"
                },
                "to": {
                  "type": "array",
                  "items": {
                        "type": "string"
                  }
                },
                "cc": {
                  "type": "array",
                  "items": {
                        "type": "string"
                  }
                },
                "bcc": {
                  "type": "array",
                  "items": {
                        "type": "string"
                  }
                },
                "subject": {
                  "type": "string"
                },
                "body": {
                  "type": "string"
                }
              },
              "required": [
                "title",
                "to",
                "cc",
              ]
            }
          }
        }


## Managing Email Group (Adding/Removing Email Addresses to Email Groups):

Use the built in tool for "Manage Group Emails". 
For added security the email use of the "MailtoManage.py" is now password protected, this is to ensure that only Authorised users are capable of changing email groups. To add new passwords, you need to modify the MailtoManage.py script and add the result of the following python3 code to the `valid_password` list variable.: 

```
clear_text_password = "supersecret2018!"
your_password = hashlib.sha256(clear_text_password.encode()).hexdigest()
```
This keeps honest people honest. 

Further more, the email database file (emaildata_v2.json), is also now signed for each email group. This prevents unauthorised changing of the email groups without triggering a warning that hashes doesn't match. E.g.
```
    {
        "Email Hash":"b613eb430b4ab3381439fbfd0e1936328083e7ae525910841598a88f95539e6b",
        "Email Group":"Jurisdiction NZ"
    },
    {
        "Email Hash":"169c894e2654c66766d00769e44609f4f4ac5f370a65f10c3fe14bdbf927ae37",
        "Email Group":"EGM SG Gaming"
    },
```

## Adding a New Email Group. 

Use the ManagetoManage.py script: Enter a new "Group Name" in the DropDown Menu and add email addresses directly. Click "Save Changes"
These can now be accessed with the "OTHER" tab templates. The "new groups created will be accessed dynamically. 

Tips: If you want the email groups to be available in the EGM/Systems Tab window in the mailto.py script then pre-pend "EGM" or "SYSTEMS" respectively to the Email Group Name. 

## Removing an Exisiting Email Group

Use the MailtoManage.py script: Select the Email Group you want to remove. Press "Delete Email Group". 
